---
title: "Impact of the Predicted Outcome on NFL Ratings"
author: "Tillman Degens"
date: "9/18/2020"
header-includes:
  - \usepackage{float}
  - \floatplacement{figure}{H}
output: 
  pdf_document:
    toc: true
    toc_depth: 4
    number_sections: true
fig_caption: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(odbc)
library(dplyr)
library(knitr)
library(stringr)
library(ggplot2)
library(kableExtra)
library(scales)
library(purrr)
library(janitor)
library(cem)
library(snakecase)
library(readxl)
library(readr)
library(DBI)
library(tidycensus)
library(stargazer)
library(broom)
library(ggplot2)
library(lubridate)

```


\pagebreak

# Background and Introduction

Professional Football has become a fundamental part of American culture, and with each new generation of athletes the game has evolved to be played a different way. From extending the sidelines, constraining the kickoff, reducing offensive penalties, and limiting the discretion defensive players can use, the NFL has shown-according to its website- that it is “open to ideas generated by any source or circumstance — or even by new technology — if it believes that the changes will improve the game”. But what is its definition of improving the game?  Ultimately football is still a business and improving the game means improving profits. 

Profits in the NFL predominantly come from five distinct avenues, merchandising, licensing rights, ticket sales, corporate sponsorships, and television deals. Of those segments the vast majority (over 50%) comes from television deals. Because of this, the most important factor driving up the NFL’s profits is television ratings, and that is exactly what the NFL is trying to increase when “Improving the game”. The rule changes over the past decade have been focused on balancing the salary cap, increasing offensive opportunities, limiting running plays, and increasing the pace of the game. In other words, they have aimed to increase parity, inflate the scoreboard, and manufacture more close games. Intuitively this makes sense, meaningful touchdowns are usually the most exciting part of football, so increasing these will lead to increased ratings. However, advertisers don’t know the actual outcome of football games before they spend significant financial capital. For this reason, they must rely on the predicted outcome to determine the games “competitiveness” and therefore ratings. When weighing the decision to spend a million dollars on a minute of advertising, this uncertainty between predicted outcome and actual rating becomes an extremely important concern. This paper aims to empirically analyze the impact of a games predicted outcome, in terms of points scored and spread, on the games actual Nielsen Rating. 



## Research Goals

The purpose of this report is initial exploratory analysis to assess the impact of an NFL football games predicted outcome on its ratings. It is aiming to determine the overall effect of the projected over/under (projected total points scored) and point spread on ratings.

# Data Description

The data used in this analysis comes from 4 main sources: 

* spreadspoke_scores.csv: This is a dataset downloaded from Kaggle containing game results, betting information, and descriptive statistics for each NFL game since 1966.
* NFLFanbase.csv: This is a dataset created for this report which is a summation of the Instagram, Twitter, and Facebook following of each NFL team used to proxy their “fanbase”.
* NFLRatings.csv: This is a combination of datasets downloaded from Statista and collected from MediaWatch. It contains the ratings and viewership statistics for each NFL game in 2015, 2016, 2017, and the first half of 2018.
* PowerRankings.csv: ESPN power ranking of each NFL team in Week 1, Week 9, and Week 17 in 2015, 2016, 2017, and the first half of 2018. This data was used to calculate the “Marque” of the matchup.

The data was joined by the home teams and away teams playing, as well as the year the teams played.

__Description of some of the fields within the joined dataset:__

* schedule_season = The season in which the game took place.The seasons were filtered down so only games from 2015, 2016, 2017, and the first half of 2018 were shown as those were the only games in the NFLRatings dataset.
* over_under_line = Betting projected total points scored in the game.
* spread_favorite = How many points the favorite was projected to win by. In other words, how close the game is projected to be.
* fanbase = Summation of the Twitter, Instagram, and Facebook followings of each team playing in the game. This value is then divided by 100,000 to scale it down. 
* Network = Network broadcasting the game.
* Rating = Nielsen rating of the game. Nielsen ratings tell media participants who was exposed to content and advertising.
* matchup = For games in the first half of the season this variable is the mean of each teams beginning of season power ranking and mid-season power ranking added together. For games in the second half of the season this variable is the mean of each teams end of season power ranking and mid-season power ranking added together. 
* day = Day broadcasted


```{r,echo=FALSE,message=FALSE,warning=FALSE}

#Load in NFL betting data

NFLSpreads<- read_csv("spreadspoke_scores.csv")

NFLSpreads$team_home <- gsub("San Diego Chargers", "Los Angeles Chargers", NFLSpreads$team_home)
NFLSpreads$team_away <- gsub("San Diego Chargers", "Los Angeles Chargers", NFLSpreads$team_away)
NFLSpreads$team_home <- gsub("St. Louis Rams", "Los Angeles Rams", NFLSpreads$team_home)
NFLSpreads$team_away <- gsub("St. Louis Rams", "Los Angeles Rams", NFLSpreads$team_away)
NFLSpreads$team_home <- gsub("Washington Redskins", "Washington Football Team", NFLSpreads$team_home)
NFLSpreads$team_away <- gsub("Washington Redskins", "Washington Football Team", NFLSpreads$team_away)

#Filter NFL Spreads to select only regular season games in years we want to analyze
NFLSpreads<- NFLSpreads%>%
  filter(schedule_season>=2015)%>%
  filter(schedule_season <=2019)%>%
  filter(schedule_playoff=="FALSE")

#Condense dataset to only variables we need
NFLSpreads<- NFLSpreads%>%
  select(schedule_date, schedule_season, schedule_week,
         team_home, team_away, score_home, score_away, 
         spread_favorite, over_under_line)

#Load in team fans, based on social media following. Create two seperate datasets to account for home and away.
NFLFanshome<- read_csv("NFLFanbase.csv")
NFLFanshome<- NFLFanshome%>%
  rename(team_home = team_name, fanbase_home = fanbase)

NFLSpreads<-left_join(NFLSpreads, NFLFanshome, by = "team_home")

NFLFansaway<- read_csv("NFLFanbase.csv")
NFLFansaway<- NFLFansaway%>%
  rename(team_away = team_name, fanbase_away = fanbase)
NFLSpreads<-left_join(NFLSpreads, NFLFansaway, by = "team_away")
  
view(tail(NFLSpreads))

#Total Fanbase for each game is both followings added together.
NFLSpreads<- NFLSpreads%>%
  mutate(fanbase= fanbase_home+fanbase_away)

#Cleaned most of the data on excel but teams must still be renamed
NFLRatings<- read_csv("NFLRatings.csv")


#Need to add city names
NFLRatings$team_home <- gsub("Cardinals", "Arizona Cardinals", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Falcons", "Atlanta Falcons", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Ravens", "Baltimore Ravens", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Bills", "Buffalo Bills", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Panthers", "Carolina Panthers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Bears", "Chicago Bears", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Bengals", "Cincinnati Bengals", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Browns", "Cleveland Browns", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Cowboys", "Dallas Cowboys", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Broncos", "Denver Broncos", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Lions", "Detroit Lions", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Packers", "Green Bay Packers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Texans",  "Houston Texans", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Colts", "Indianapolis Colts", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Jaguars", "Jacksonville Jaguars", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Chiefs", "Kansas City Chiefs", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Raiders", "Las Vegas Raiders", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Chargers", "Los Angeles Chargers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Rams", "Los Angeles Rams", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Dolphins", "Miami Dolphins", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Vikings", "Minnesota Vikings", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Patriots", "New England Patriots", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Saints", "New Orleans Saints", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Giants", "New York Giants", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Jets", "New York Jets", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Eagles", "Philadelphia Eagles", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Steelers", "Pittsburgh Steelers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("49ers", "San Francisco 49ers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Seahawks", "Seattle Seahawks", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Buccaneers", "Tampa Bay Buccaneers", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Titans", "Tennessee Titans", NFLRatings$team_home)
NFLRatings$team_home <- gsub("Washington Football Team", "Washington Football Team", NFLRatings$team_home)
NFLRatings$team_away <- gsub("Cardinals", "Arizona Cardinals", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Falcons", "Atlanta Falcons", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Ravens", "Baltimore Ravens", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Bills", "Buffalo Bills", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Panthers", "Carolina Panthers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Bears", "Chicago Bears", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Bengals", "Cincinnati Bengals", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Browns", "Cleveland Browns", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Cowboys", "Dallas Cowboys", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Broncos", "Denver Broncos", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Lions", "Detroit Lions", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Packers", "Green Bay Packers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Texans",  "Houston Texans", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Colts", "Indianapolis Colts", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Jaguars", "Jacksonville Jaguars", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Chiefs", "Kansas City Chiefs", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Raiders", "Las Vegas Raiders", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Chargers", "Los Angeles Chargers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Rams", "Los Angeles Rams", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Dolphins", "Miami Dolphins", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Vikings", "Minnesota Vikings", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Patriots", "New England Patriots", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Saints", "New Orleans Saints", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Giants", "New York Giants", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Jets", "New York Jets", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Eagles", "Philadelphia Eagles", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Steelers", "Pittsburgh Steelers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("49ers", "San Francisco 49ers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Seahawks", "Seattle Seahawks", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Buccaneers", "Tampa Bay Buccaneers", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Titans", "Tennessee Titans", NFLRatings$team_away)
NFLRatings$team_away <- gsub("Washington Football Team", "Washington Football Team", NFLRatings$team_away)

#Rename Columns to Join
NFLRatings<- NFLRatings%>%
  rename(schedule_week = Week)

NFLData<- left_join(NFLSpreads, NFLRatings, by = c("team_away", "team_home", "schedule_season"))
NFLData<- NFLData%>%
  filter(schedule_season <=2018)%>%
  filter(!is.na(Network))
view(NFLData)

#Add in Day of Week
NFLData$day<- weekdays(as.Date(NFLData$schedule_date))


#Add in the Power Rankings to account for how "good" of a matchup the game is.
PowerRank<-read_csv("PowerRankings.csv")
#view(PowerRank)

#For Home Teams
PowerRankHome<-PowerRank%>%
  select(Team_home, schedule_season, schedule_star, schedule_middle,schedule_end)
PowerRankHome<- PowerRankHome%>%
  rename(schedule_start_home = schedule_star, schedule_middle_home = schedule_middle,
         schedule_end_home = schedule_end, team_home = Team_home)

#For Away Teams
PowerRankAway<-PowerRank%>%
  select(team_away, schedule_season, schedule_star, schedule_middle,schedule_end)
PowerRankAway<- PowerRankAway%>%
  rename(schedule_start_away = schedule_star, schedule_middle_away = schedule_middle,
         schedule_end_away = schedule_end)

#Join Powerank with NFLData dataset.
NFLData<- left_join(NFLData, PowerRankHome, by = c("team_home", "schedule_season"))
NFLData<- left_join(NFLData, PowerRankAway, by = c("team_away", "schedule_season"))
#view(NFLData)

#Create team "Strength" for each section of the season, home team
NFLData<- NFLData%>%
  mutate(strength_home_team = if_else(schedule_week.x >=1 & schedule_week.x<=8,
         (schedule_start_home+schedule_middle_home)/2,
         (schedule_middle_home+schedule_end_home)/2))

#Create team "Strength" for each section of the season, away team
NFLData<- NFLData%>%
  mutate(strength_away_team = if_else(schedule_week.x >=1 & schedule_week.x<=8,
          (schedule_start_away+schedule_middle_away)/2,
          (schedule_middle_away+schedule_end_away)/2))

#Add both teams together to calculate "strength" of matchup
NFLData<- NFLData%>%
  mutate(matchup = strength_home_team + strength_away_team)


#view(NFLData)

#Filter so that only prime-time games are shown.
NFLData<-NFLData%>%
  filter((Network== "NBC" & day != "Saturday")| (day == "Thursday" | day == "Monday"))

NFLData<- NFLData%>%
  mutate(Rating = as.numeric(Rating))

#One game without a rating, must be removed

NFLData<-NFLData%>%
  filter(!is.na(Rating))


```

# Data Filtering and Summary Statistics

An important aspect about football and ratings is the way the games are broadcasted. Each week NFL games are generally broadcasted in five different time slots, Thursday night, Sunday morning, Sunday afternoon, Sunday night, and Monday night. Out of those time slots the bulk of the games are broadcasted by Fox and CBS Sunday morning and Sunday night. Those games are broadcasted locally so different regions will likely be viewing different games. In addition, many NFL viewers have transitioned to services such as NFL Redzone, which jumps from game to game in the early and afternoon window. For these reasons it is difficult to accurately measure the ratings and self-selection of viewers for the morning and afternoon games. To account for this, the data was filtered to only include the nationally broadcasted games, Monday night, Sunday night, and Thursday night.

```{r,echo=FALSE}
NFLData %>%
  group_by(day) %>%
  summarise(N = n(),
            avg_baseline = mean(Rating),
            max_baseline = max(Rating),
            min_baseline = min(Rating),
           sd_baseline = sd(Rating)) %>% 
  kable(format = "latex", booktabs = TRUE,
        #align = "c",
        col.names = c("Day Broadcasted","N","mean","max","min","sd"),
        caption = "Ratings for Each day Broadcasted",
        format.args = list(big.mark= ",")) %>%
  kable_styling(font_size = 11, latex_options = c("HOLD_position")) 
```

This table is what intuition would suggest. In addition to the Sunday night time slot generally having first dibs on the game broadcasted, the Sunday night game is broadcasted publicly, on NBC. This is opposed to the Monday night and Thursday night games which are on cable television, broadcasted by NFL Network and ESPN respectively. Due to the signifigant difference in ratings for each day I will be conducting seperate analyses on each time slot.
\pagebreak

# Model Description and Regression Results

To create a model showing the impact of a games projected outcome on its actual ratings I consulted similar academic literature, most notably Paul and Weinbachs article: The uncertainty of outcome and scoring effects on Nielsen ratings for Monday Night Football in Volume 59, Issue 3 of The Journal of Economics and Business. I also looked at what NFL executives have indicated are the largest trends recently influencing ratings. The model I elected to use is shown below:

$$\widehat{Rating}= \hat{\beta_0} + \hat{\beta_1}X_1 + \hat{\beta_2}X_2 + \hat{\beta_3}X_3 + \hat{\beta_4}X_4 + \hat{\beta_5}X_5 + \hat{\beta_6}X_6 + \hat{\beta_7}X_7 + \hat{\beta_8}X_8 + \hat{\beta_9}X_9 + \epsilon$$




__For the Overall Results:__

* $Rating$ = Rating
* $X_1$ = over_under, which represents the total points scored in a given NFL game.
* $X_2$ = spread, which is the absolute value of Vegas's projected point spread.
* $X_3$ = y2015, which is a dummy variable representing a game played in 2015.
* $X_4$ = y2016, which is a dummy variable representing a game played in 2016.
* $X_5$ = y2017, which is a dummy variable representing a game played in 2017.
* $X_6$ = y2018, which is a dummy variable representing a game played in 2018.
* $X_7$ = Fanbase, which is the summation of the social media following of each team playing.
* $X_8$ = matchup, which is a proxy variable for how "good" the teams are going into the game.
* $X_9$ = first_half, which is a dummy variable for whether the game was played in the first half of the season.
* $e$ = residual error.
```{r,echo=FALSE,message=FALSE,warning=FALSE}
#Create the new model variables
NFLData<-NFLData%>%
  mutate(y2015 = if_else(schedule_season== "2015", 1,0))%>%
  mutate(y2016 = if_else(schedule_season== "2016", 1,0))%>%
  mutate(y2017 = if_else(schedule_season== "2017", 1,0))%>%
  mutate(y2018 = if_else(schedule_season== "2018", 1,0))%>%
  mutate(first_half = if_else(schedule_week.x >=1 & schedule_week.x<=8, 1,0))%>%
  mutate(spread = abs(spread_favorite))%>%
  mutate(fanbase = fanbase/100000)
#fanbase is changed to account for difference in scale

```
The primary variables of interest in this model are the games over under and the spread, as these predict how high scoring each game will be and how close, resulting in a rough prediction of the "excitement". I incorporated a dummy variable for each year to account for time trends and current events impacting ratings. For example, I expected ratings to dip slightly in 2016 and 2017 due to the Donald Trump’s consistent twitter feud with the NFL. I designated the Fanbase as a variable to weigh in the impact of viewers who just want to watch a specific team, rather than a close game, it is expected that games with larger followings will have higher ratings. I used social media following instead of market size to account for teams such as the Green Bay Packers who have one of the largest followings despite having the smallest market size. The variable matchup is meant to represent the "quality" of the game in terms of how good each team is during that portion of the season. The dummy variable first half was included to account for seasonal competitors for ratings such as the World Series during the first half of the season or the NBA during the second half. This model was ran separately on the Thursday, Sunday, and Monday, broadcasting slots.
\pagebreak

## Results for Monday Night Football

```{r,echo=FALSE, message=FALSE, warning=FALSE}

#Analysis for monday night
RegDataset <- NFLData %>%
  filter(day=="Monday")
reg1 <- lm(Rating ~ + over_under_line + spread + y2015 + y2016 +
              y2017 + y2018 +fanbase + matchup + first_half,
            data = RegDataset)
  

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
stargazer(reg1, 
          title = "Results for Monday Night Football",
          type = "latex",
          single.row = TRUE,
          ci = TRUE,
          ci.level = 0.90,
          header = FALSE)
```

## Results for Sunday Night Football
```{r,echo=FALSE, message=FALSE, warning=FALSE}

#Analysis for sunday night
RegDataset <- NFLData %>%
  filter(day=="Sunday")
reg2 <- lm(Rating ~ + over_under_line + spread + y2015 + y2016 +
              y2017 + y2018 +fanbase + matchup + first_half,
            data = RegDataset)
  

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
stargazer(reg2, 
          title = "Results for Sunday Night Football",
          type = "latex",
          single.row = TRUE,
          ci = TRUE,
          ci.level = 0.90,
          header = FALSE)
```

## Results for Thursday Night Football
```{r,echo=FALSE, message=FALSE, warning=FALSE}

#Analysis for thursday night
RegDataset <- NFLData %>%
  filter(day=="Thursday")
reg3 <- lm(Rating ~ + over_under_line + spread + y2015 + y2016 +
              y2017 + y2018 +fanbase + matchup + first_half,
            data = RegDataset)
  

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
stargazer(reg3, 
          title = "Results for Thursday Night Football",
          type = "latex",
          single.row = TRUE,
          ci = TRUE,
          ci.level = 0.90,
          header = FALSE)
```

# Interpretation of Results

Looking at the results for each broadcasting slot it is suggested that the yearly trends have the most significant impact on a football games rating. As expected, ratings were the highest in 2015 and variable thereafter. It can be assumed that this is associated with Trumps political feud with the NFL. Fanbase and matchup are the other two variables that are consistently significant, and their impact is aligned with what was predicted. A 100,000 follower increase in the teams playing implied a .018, .026, and .033 increase in ratings for Monday, Sunday, and Thursday night football, respectively. For matchup, as the rankings of the teams playing fall (meaning they are not as good) so does the rating which is what was predicted. For the primary variables of interest, predicted spread and over under there does not appear to be a concrete relationship with ratings. As the spread increases (the games are predicted to be less close) the ratings decrease, which was predicted. However, the relationship is minimal and is not statistically significant. As the over/under increases the ratings decrease meaning they are lower for predicted high scoring games. However, like spread this is also marginal and not statistically significant. 

The results of this analysis are inconclusive at best and very little can be inferred from them. They do not disprove a relationship between predicted “competitiveness” of a football game and television ratings, but they do not prove one either.

\pagebreak
# Works Cited

Rodney J. Paul, Andrew P. Weinbach,

The uncertainty of outcome and scoring effects on Nielsen ratings for Monday Night Football,
Journal of Economics and Business,

Volume 59, Issue 3,

2007,

Pages 199-211,

ISSN 0148-6195,

https://doi.org/10.1016/j.jeconbus.2006.05.001.

(http://www.sciencedirect.com/science/article/pii/S014861950600052X)

Abstract: Nielsen ratings for Monday Night Football are analyzed through regression models to determine the factors that attract and keep viewers. For start-of-game ratings, the uncertainty of outcome, quality of the teams, and expected scoring are shown to be important factors. For within-game changes in ratings, the halftime score differential and halftime total points scored, in addition to the quality of teams playing the game, are shown to be significant determinants. Evidence is found that fans prefer games with a quality match-up between winning teams, a high level of uncertainty of outcome, and high-scoring.

Keywords: Sports; Consumer preferences
